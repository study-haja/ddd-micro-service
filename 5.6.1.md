## DDD의 전술적 설계(도메인 모델링 구성요소)

* 기존 객체 모델링 방식은 자유도가 높아 문제 영역을 파고들수록 여러 층의 복잡한 계층 구조를 만들게 될 가능성이 높다.
* 이를 정리하기 위해 DDD의 전술적 설계 기법에 따라 단순하고 이해하기 쉽게 만들 수 있다.



### 엔티티

* 엔티티는 다른 엔티티와 구별할 수 있는 식별자를 가진 도메인의 실체 개념을 표현하는 객체다.
* 식별자는 고유하되 엔티티의 속성 및 상태는 계속 변할 수 있다.
* 도메인에서 개별성이 있는 개념을 엔티티로 식별하며, 고유 식별자와 변환 가능성이 엔티티와 값 객체를 구분하는 차이점이다.



### 값 객체 (VO)

* 값 객체는 각 속성이 개별적으로 변화하지 않는 개념적 완정성을 모델링한다.
* 속성과 속성의 합에 의해 전체 개념이 부여되며, 개별 속성이 별개로 수정되지 않고 전체 객체가 한번에 생성되거나 삭제되는 객체이다.
* 속성과 속성으로 이루어진 값의 비교에 의해 동일함이 결정된다.
* 반 버논은 VO를 다음과 같이 설명한다.
  * 도메인 내의 어떤 대상을 측정하고, 수량화하고, 설명한다.
  * 관련 특징을 모은 필수 단위로 개념적 전체를 모델링한다.
  * 측정이나 설명이 변경될 땐 완벽히 대체 가능하다.
  * 다른 값과 등가성을 사용해 비교할 수 있다.
  * 값 객체는 일단 생성되면 변경할 수 없다.



### 표준 타입

* 표준 타입은 대상의 타입을 나타내는 서술적 객체다.
* 엔티티나 값 객체의 속성을 구분하는 용도로 사용한다.
* 코드로 표현하면 매핑표가 있어야 하기 때문에 보통 컨텍스트에 맞는 이해 가능한 유비쿼터스 용어로 정의하는 것이 바람직하다.
* 자바 언어는 보통 열거형으로 정의한다.



### 애그리거트

* 엔티티와 값 객체로 모델링하게 되면 자연스럽게 객체 간의 계층구조가 만들어지는데, 이처럼 연관된 엔티티와 값 객체들의 묶음이 애그리거트이다.
* 애그리거트는 비즈니스 의존관계를 맺고 있으며, 비즈니스 정합성을 맞출 필요가 있다.
* 따라서 애그리거트 단위가 트랜잭션의 기본 단위가 된다.
* 애그리거트 내에 있는 엔티티 중 가장 상위의 엔티티를 애그리거트 루트로 정하고, 이 애그리거트 루트를 통해서만 애그리거트 내의 엔티티나 값 객체를 변경할 수 있다.
* 보통 하나의 컨텍스트 안에 하나의 애그리거트가 존재하지만, 여러개의 애그리거트가 존재할 수 있다.
* 이 경우 다른 애그리거트를 참조해야 할 필요가 있다면 직접 참조하지 않고 간접 참조하게 한다.
* 직접 참조의 문제점
  * 의존성이 생겨 트랜잭션 처리도 힘들고, 점점 복잡해짐
  * 같은 컨텍스트 내에 여러 개의 애그리거트가 존재할 경우 직접 참조시 마이크로서비스로 분리하기 힘듦
* 애그리거트의 단일 트랜잭션을 유지하면서 다른 애그리거트 사이의 일관성이 필요하다면 도메인 이벤트를 사용하면 된다.



### 도메인 서비스

* 도메인 비즈니스 로직 처리가 특정 엔티티나 값 객체의 속하지 않을 때 단독 객체를 만들어서 처리하게 하는데, 이를 도메인 서비스라 한다.
* 도메인 서비스는 상태를 관리하지 않고 행위만 존재한다.
* 엔티티의 값 객체와 함께 특정 작업을 처리하고 상태를 본인이 가지고 있지 않고 엔티티나 값 객체에 전달한다.



### 도메인 이벤트

* 애그리거트간 혹은 마이크로서비스간 정합성을 맞추기 위해 이벤트 메시지 매커니즘을 말한다.
* 서비스 간 정합성을 일치시키기 위해 단위 애그리거트의 주요 상태 값을 담아 전달되도록 모델링한다.